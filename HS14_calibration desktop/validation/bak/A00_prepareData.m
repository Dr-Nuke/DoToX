
close all
clear
clc
load('T')

% load matrix "P" which is the raw phantom images before downsampling and setting attenuation values
% where each layer of the matrix is a film thickness from 0.1:0.1:1.5 mm
% pixel resolution 0.01 mm
% 0 = aluminum, 1 = outside channel, 2 = H2O, 3 = void in channel, 4 = film
load allRawPhantomData
% rename to longer variable name
phantomDataAll = P;

% Photon    Tot. w/  
% Energy    Coherent 
% energy [MeV], CHCl3, H2O, Al
xsData=[
1.100E-02, 3.905E+01, 4.026E+00, 1.981E+01; 
1.200E-02, 3.043E+01, 3.126E+00, 1.534E+01; 
1.300E-02, 2.417E+01, 2.487E+00, 1.212E+01; 
1.400E-02, 1.951E+01, 2.021E+00, 9.744E+00; 
1.500E-02, 1.598E+01, 1.672E+00, 7.955E+00; 
1.600E-02, 1.326E+01, 1.408E+00, 6.583E+00; 
1.700E-02, 1.112E+01, 1.203E+00, 5.513E+00; 
1.800E-02, 9.421E+00, 1.042E+00, 4.667E+00; 
1.900E-02, 8.055E+00, 9.134E-01, 3.990E+00; 
2.000E-02, 6.944E+00, 8.098E-01, 3.442E+00; 
2.100E-02, 6.031E+00, 7.253E-01, 2.993E+00; 
2.200E-02, 5.274E+00, 6.557E-01, 2.623E+00; 
2.300E-02, 4.642E+00, 5.978E-01, 2.314E+00; 
2.400E-02, 4.109E+00, 5.493E-01, 2.055E+00; 
2.500E-02, 3.657E+00, 5.082E-01, 1.836E+00; 
2.600E-02, 3.272E+00, 4.733E-01, 1.649E+00; 
2.700E-02, 2.941E+00, 4.433E-01, 1.489E+00; 
2.800E-02, 2.655E+00, 4.175E-01, 1.351E+00; 
2.900E-02, 2.407E+00, 3.951E-01, 1.232E+00; 
3.000E-02, 2.190E+00, 3.756E-01, 1.128E+00; 
3.100E-02, 2.001E+00, 3.584E-01, 1.037E+00; 
3.200E-02, 1.834E+00, 3.433E-01, 9.576E-01; 
3.300E-02, 1.687E+00, 3.300E-01, 8.873E-01; 
3.400E-02, 1.557E+00, 3.181E-01, 8.250E-01; 
3.500E-02, 1.441E+00, 3.075E-01, 7.696E-01; 
3.600E-02, 1.337E+00, 2.980E-01, 7.202E-01; 
3.700E-02, 1.244E+00, 2.894E-01, 6.760E-01; 
3.800E-02, 1.161E+00, 2.817E-01, 6.364E-01; 
3.900E-02, 1.086E+00, 2.747E-01, 6.007E-01; 
4.000E-02, 1.019E+00, 2.683E-01, 5.684E-01; 
4.100E-02, 9.574E-01, 2.625E-01, 5.392E-01; 
4.200E-02, 9.019E-01, 2.571E-01, 5.128E-01; 
4.300E-02, 8.514E-01, 2.523E-01, 4.886E-01; 
4.400E-02, 8.053E-01, 2.478E-01, 4.667E-01; 
4.500E-02, 7.632E-01, 2.436E-01, 4.466E-01; 
4.600E-02, 7.247E-01, 2.398E-01, 4.281E-01; 
4.700E-02, 6.893E-01, 2.362E-01, 4.112E-01; 
4.800E-02, 6.568E-01, 2.329E-01, 3.957E-01; 
4.900E-02, 6.269E-01, 2.298E-01, 3.814E-01; 
5.000E-02, 5.993E-01, 2.269E-01, 3.681E-01; 
5.100E-02, 5.738E-01, 2.242E-01, 3.559E-01; 
5.200E-02, 5.501E-01, 2.217E-01, 3.446E-01; 
5.300E-02, 5.282E-01, 2.193E-01, 3.340E-01; 
5.400E-02, 5.079E-01, 2.171E-01, 3.242E-01; 
5.500E-02, 4.890E-01, 2.149E-01, 3.151E-01; 
5.600E-02, 4.714E-01, 2.129E-01, 3.066E-01; 
5.700E-02, 4.550E-01, 2.110E-01, 2.987E-01; 
5.800E-02, 4.396E-01, 2.092E-01, 2.913E-01; 
5.900E-02, 4.253E-01, 2.075E-01, 2.843E-01; 
6.000E-02, 4.119E-01, 2.059E-01, 2.778E-01; 
6.100E-02, 3.993E-01, 2.043E-01, 2.717E-01; 
6.200E-02, 3.876E-01, 2.028E-01, 2.659E-01; 
6.300E-02, 3.765E-01, 2.014E-01, 2.605E-01; 
6.400E-02, 3.661E-01, 2.000E-01, 2.554E-01; 
6.500E-02, 3.563E-01, 1.987E-01, 2.506E-01; 
6.600E-02, 3.470E-01, 1.974E-01, 2.460E-01; 
6.700E-02, 3.383E-01, 1.962E-01, 2.417E-01; 
6.800E-02, 3.301E-01, 1.951E-01, 2.376E-01; 
6.900E-02, 3.223E-01, 1.939E-01, 2.338E-01; 
7.000E-02, 3.149E-01, 1.929E-01, 2.301E-01; 
7.100E-02, 3.080E-01, 1.918E-01, 2.266E-01; 
7.200E-02, 3.014E-01, 1.908E-01, 2.233E-01; 
7.300E-02, 2.951E-01, 1.898E-01, 2.202E-01; 
7.400E-02, 2.891E-01, 1.888E-01, 2.172E-01; 
7.500E-02, 2.835E-01, 1.879E-01, 2.143E-01; 
7.600E-02, 2.781E-01, 1.870E-01, 2.116E-01; 
7.700E-02, 2.730E-01, 1.861E-01, 2.089E-01; 
7.800E-02, 2.681E-01, 1.853E-01, 2.064E-01; 
7.900E-02, 2.635E-01, 1.845E-01, 2.041E-01; 
8.000E-02, 2.590E-01, 1.837E-01, 2.018E-01; 
8.100E-02, 2.548E-01, 1.829E-01, 1.996E-01; 
8.200E-02, 2.507E-01, 1.821E-01, 1.975E-01; 
8.300E-02, 2.469E-01, 1.814E-01, 1.955E-01; 
8.400E-02, 2.431E-01, 1.806E-01, 1.935E-01; 
8.500E-02, 2.396E-01, 1.799E-01, 1.917E-01; 
8.600E-02, 2.362E-01, 1.792E-01, 1.899E-01; 
8.700E-02, 2.329E-01, 1.785E-01, 1.881E-01; 
8.800E-02, 2.298E-01, 1.779E-01, 1.865E-01; 
8.900E-02, 2.268E-01, 1.772E-01, 1.849E-01; 
9.000E-02, 2.239E-01, 1.766E-01, 1.833E-01; 
9.100E-02, 2.211E-01, 1.759E-01, 1.818E-01; 
9.200E-02, 2.185E-01, 1.753E-01, 1.804E-01; 
9.300E-02, 2.159E-01, 1.747E-01, 1.790E-01; 
9.400E-02, 2.134E-01, 1.741E-01, 1.777E-01; 
9.500E-02, 2.111E-01, 1.735E-01, 1.764E-01; 
9.600E-02, 2.088E-01, 1.729E-01, 1.751E-01; 
9.700E-02, 2.066E-01, 1.724E-01, 1.739E-01; 
9.800E-02, 2.044E-01, 1.718E-01, 1.727E-01; 
9.900E-02, 2.024E-01, 1.713E-01, 1.715E-01; 
1.000E-01, 2.004E-01, 1.707E-01, 1.704E-01; 
1.010E-01, 1.984E-01, 1.702E-01, 1.693E-01; 
1.020E-01, 1.966E-01, 1.697E-01, 1.683E-01; 
1.030E-01, 1.948E-01, 1.692E-01, 1.673E-01; 
1.040E-01, 1.930E-01, 1.686E-01, 1.663E-01; 
1.050E-01, 1.914E-01, 1.681E-01, 1.653E-01; 
1.060E-01, 1.897E-01, 1.677E-01, 1.644E-01; 
1.070E-01, 1.881E-01, 1.672E-01, 1.634E-01; 
1.080E-01, 1.866E-01, 1.667E-01, 1.625E-01; 
1.090E-01, 1.851E-01, 1.662E-01, 1.617E-01; 
1.100E-01, 1.837E-01, 1.657E-01, 1.608E-01;];

densities=[1.411, 0.9555, 2.70]; %g/cm3, water: 2bar/ 104 °C
[rows,cols] = size(xsData);
macroXSall = xsData(:,2:end).*repmat(densities,rows,1);

% seprate into different variables
macroXSenergies= xsData(:,1)*1000; % energies in keV, steps of  1 keV from 11 to 110
macroXSchloroform = macroXSall(:,1);
macroXSwater = macroXSall(:,2);
macroXSaluminum = macroXSall(:,3);
%%


% plot cross-section values
%plot(macroXSenergies,macroXSall,'LineWidth',3); grid on; xlim([30 inf]); ylim([0 3.5])
%xlabel('Energy [keV]');ylabel('attenuation [1/cm]');legend('CHCl3', 'H2O', 'Al');

% clear variables no longer needed
clear rows cols densities xsData P
